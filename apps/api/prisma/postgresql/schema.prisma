// prisma generate --schema=prisma/postgresql/schema.prisma
// prisma db push --schema=prisma/postgresql/schema.prisma

generator client {
  provider      = "prisma-client-js"
  output        = "../../src/generated/prisma/postgresql"
  binaryTargets = ["native", "darwin", "darwin-arm64", "linux-arm64-openssl-3.0.x", "linux-musl-openssl-3.0.x", "windows", "debian-openssl-1.1.x"]
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL_POSTGRESQL")
  directUrl = env("DATABASE_DIRECT_URL_POSTGRESQL")
}

enum GenderEnum {
  MALE
  FEMALE
}

enum UserPartEnum {
  PLAN
  DESIGN
  WEB
  ANDROID
  IOS
  SPRINGBOOT
  NODEJS
  NULL
}

model Challenger {
  id              BigInt     @id @default(autoincrement())
  umsbId          BigInt     @map("umsb_id")
  name            String
  nickname        String
  gender          GenderEnum
  schoolId        BigInt     @map("school_id")
  studentId       String     @map("student_id")
  profileImageUrl String?    @map("profile_image_url")
  passwordHash    String     @map("password_hash")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  school             School           @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  gisuRoles          ChallengerGisu[]
  leaderGisuSchool   ChapterSchool[]  @relation("LeaderOfGisuSchool")
  viceLeadGisuSchool ChapterSchool[]  @relation("ViceLeaderOfGisuSchool")
  projectMembers     ProjectMember[]
  applications       Application[]

  @@map("challenger")
}

model ChallengerGisu {
  id              BigInt @id @default(autoincrement())
  challengerId    BigInt @map("challenger_id")
  chapterSchoolId BigInt @map("chapter_school_id")

  isTerminated Boolean @default(false) @map("is_terminated")

  part UserPartEnum

  // 학교/지부/중앙운영사무국 운영진 여부
  isSchoolAdmin    Boolean @map("is_school_admin")
  isChapterAdmin   Boolean @map("is_chapter_admin")
  isCentralAdmin   Boolean @map("is_central_admin")
  // 각 역할
  schoolAdminType  String? @map("school_admin_type")
  chapterAdminType String? @map("chapter_admin_type")
  centralAdminType String? @map("central_admin_type")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  challenger    Challenger  @relation(fields: [challengerId], references: [id], onDelete: Cascade)
  chapterSchool GisuChapter @relation(fields: [chapterSchoolId], references: [id], onDelete: Cascade)

  @@map("challenger_gisu")
}

model Gisu {
  id          BigInt  @id @default(autoincrement())
  name        String
  description String?
  isCurrent   Boolean @default(false) @map("is_current")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  chapters GisuChapter[] // 기수에는 여러 개의 지부가 있습니다.

  @@map("gisu")
}

model GisuChapter {
  id          BigInt  @id @default(autoincrement())
  name        String
  description String?
  gisuId      BigInt  @map("gisu_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  gisu                  Gisu             @relation(fields: [gisuId], references: [id], onDelete: Cascade)
  projects              Project[] // 지부에는 여러 개의 프로젝트가 생성되어 있습니다.
  chapterMatchingRound  MatchingRound[] // 지부 별 매칭 라운드를 생성합니다.
  gisuChapterSchool     ChapterSchool[] // 지부에 속한 학교들
  gisuChapterChallenger ChallengerGisu[] // 지부에 속한 챌린저들

  @@map("chapter")
}

model ChapterSchool {
  id        BigInt @id @default(autoincrement())
  chapterId BigInt @map("chapter_id")
  schoolId  BigInt @map("school_id")

  // 해당 기수 학교 회장, 부회장
  leaderId     BigInt? @map("leader_id")
  viceLeaderId BigInt? @map("vice_leader_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  chapter    GisuChapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  school     School      @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  leader     Challenger? @relation("LeaderOfGisuSchool", fields: [leaderId], references: [id])
  viceLeader Challenger? @relation("ViceLeaderOfGisuSchool", fields: [viceLeaderId], references: [id])

  @@map("gisu_school")
}

model School {
  id           BigInt  @id @default(autoincrement())
  name         String
  logoImageUrl String? @map("logo_image_url")
  description  String?

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  challengers Challenger[]
  gisuSchools ChapterSchool[]

  @@map("school")
}

model Project {
  id             BigInt  @id @default(autoincrement())
  name           String
  description    String?
  chapterId      BigInt  @map("chapter_id")
  logoImageUrl   String? @map("logo_image_url")
  bannerImageUrl String? @map("banner_image_url")

  // 파트별 TO류
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  chapter          GisuChapter       @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  members          ProjectMember[] // 프로젝트에 속한 인원
  applicationForms ApplicationForm[] // 프로젝트에 생성된 지원용 폼들
  to               ProjectTo[] // 프로젝트 파트별 TO

  @@map("project")
}

model ProjectTo {
  id        BigInt       @id @default(autoincrement())
  projectId BigInt       @map("project_id")
  part      UserPartEnum
  to        Int          @map("to")
  createdAt DateTime     @default(now()) @map("created_at")
  updatedAt DateTime     @updatedAt @map("updated_at")

  // 관계 필드
  project Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("project_to")
}

model ProjectMember {
  id           BigInt   @id @default(autoincrement())
  projectId    BigInt   @map("project_id")
  challengerId BigInt   @map("challenger_id")
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // 관계 필드
  project    Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  challenger Challenger @relation(fields: [challengerId], references: [id], onDelete: Cascade)

  @@map("project_member")
}

model ApplicationForm {
  id          BigInt   @id @default(autoincrement())
  projectId   BigInt   @map("project_id")
  title       String
  description String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // 관계 필드
  project      Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  questions    FormQuestion[]
  applications Application[]

  @@map("application_form")
}

enum QuestionTypeEnum {
  SINGLE_CHOICE
  MULTIPLE_CHOICE
  SUBJECTIVE
}

model FormQuestion {
  id     BigInt @id @default(autoincrement())
  formId BigInt @map("form_id")

  questionNo  Int     @map("question_no")
  title       String
  description String?

  type    QuestionTypeEnum
  options String[]

  isRequired Boolean @default(true) @map("is_required")
  isDeleted  Boolean @default(false) @map("is_deleted")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  form      ApplicationForm       @relation(fields: [formId], references: [id], onDelete: Cascade)
  responses ApplicationResponse[]

  @@map("form_question")
}

enum ApplicationStatusEnum {
  PENDING
  CONFIRMED
  REJECTED
}

model Application {
  id              BigInt                @id @default(autoincrement())
  formId          BigInt                @map("form_id")
  applicantId     BigInt                @map("applicant_id")
  matchingRoundId BigInt                @map("matching_round_id")
  status          ApplicationStatusEnum
  createdAt       DateTime              @default(now()) @map("created_at")
  updatedAt       DateTime              @updatedAt @map("updated_at")

  // 관계 필드
  form          ApplicationForm       @relation(fields: [formId], references: [id], onDelete: Cascade)
  applicant     Challenger            @relation(fields: [applicantId], references: [id], onDelete: Cascade)
  matchingRound MatchingRound         @relation(fields: [matchingRoundId], references: [id], onDelete: Cascade)
  responses     ApplicationResponse[]

  @@map("application")
}

model ApplicationResponse {
  id            BigInt   @id @default(autoincrement())
  applicationId BigInt   @map("application_id")
  questionId    BigInt   @map("question_id")
  value         String[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // 관계 필드
  application Application  @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  question    FormQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@map("application_response")
}

model MatchingRound {
  id          BigInt   @id @default(autoincrement())
  name        String
  description String?
  chapterId   BigInt   @map("chapter_id")
  startAt     DateTime @map("start_at")
  endAt       DateTime @map("end_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // 관계 필드
  applications Application[]
  chapter      GisuChapter   @relation(fields: [chapterId], references: [id], onDelete: Cascade)

  @@map("matching_round")
}
